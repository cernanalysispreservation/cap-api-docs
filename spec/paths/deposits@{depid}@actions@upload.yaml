parameters:
  - name: depid
    in: path
    description: Deposit/Draft ID
    schema:
      type: string
      format: uuid
    required: true
post:
  tags:
    - Deposits
  summary: Upload action for repositories
  description: >-

    - **Download** a snapshot of repository, that you'd like to preserve with your analysis.
      You can point to the whole repo, specific branch or even a single file whatever your analysis needs.
      Some repositories are private or restricted for CERN users only (like all the repos in CERN Gitlab) - 
      to download those you need to connect your Github/Gitlab account first.

    - **Connect** repositories with analysis that are still in progress, to keep them in sync.
      We'll make a new snapshot on any changes pushed in this repository.
      This way your analysis will be always up to date with your code. 
      Keep in mind that you cannot connect to public repositories (owner has to give you a specific access to do that).
      Upload files/data to your analysis, in a specified deposit record.

  operationId: connectToDeposit
  requestBody:
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/UploadRepositories'
        examples:
          Create Repository as user and attach to deposit:
            value:
              url: https://github.com/cernanalysispreservation/cap-api-docs
              webhook: repo_create
          Attach Repository to deposit:
            value:
              url: https://github.com/cernanalysispreservation/cap-api-docs/README.md
              webhook: repo_download_attach
          Create Repository from Schema configuration and attach to depoit:
            value:
              webhook: repo_create_default
  responses:
    '201':
      description: Created
      headers:
        X-Rate-Limit:
          description: calls per hour allowed by the user
          schema:
            type: integer
            format: int32
        X-Expires-After:
          $ref: '#/components/headers/ExpiresAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DepositResponse'
          example:
            $ref: '#/components/examples/depositResponse'
    '401':
      $ref: '#/components/responses/NotAuthorized'
